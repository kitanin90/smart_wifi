# smart_wifi
## I. Развертывание проекта на Ubuntu 18.04

### 1. Установить git на Ubuntu
Выполнить команды в терминале:
* sudo apt update
* sudo apt install git

### 2. Скачать проект с git
Выполнить команду в терминале:
* git clone https://github.com/kitanin90/smart_wifi.git

### 3. Установка Docker на Ubuntu 
* Выполните инструкцию на сайте https://www.digitalocean.com/community/tutorials/docker-ubuntu-18-04-1-ru

### 4. Настройка проекта
После успешной загрузки необходимо провести ряд настроек:
* Скопировать `.env.example` в `.env` и отредактировать файл
* Запустить `docker-compose up -d`
* Создать суперпользователя `docker-compose exec web python3 manage.py createsuperuser`
* Выполнить миграцию `docker-compose exec web python3 manage.py migrate`

# II. Настройка роутера на примере tp-link archer c7
* Скачать прошивку Openwrt `http://downloads.openwrt.org/releases/18.06.4/targets/ar71xx/generic/openwrt-18.06.4-ar71xx-generic-archer-c7-v4-squashfs-factory.bin`
* Подключиться к роутеру через сетевой кабель в любой LAN-порт.
* В админ панели роутера в разделе `fireware upgrade` загрузить скачанный файл прошивки OpenWrt

![Alt text](img/img1.jpg?raw=true "Title")
**Проводная сеть интернета должна быть общедоступной.**

* Перейти по 192.168.1.1 (или 192.168.0.1) в админку 0penWrt. Поставить на роутер пароль.
* В разделе `Interfeces` удалить интерфейс WAN6
* Настроить интерфейс WAN:

![Alt text](img/img2.jpg?raw=true "Title")
**Внимание! Не забудьте в конце поставить галочку около `Ignore interface`**

* Настроить firewall для зоны WAN. Переключить Input на accept

![Alt text](img/firewall.png?raw=true "Title")

* Перезагрузить роутер и подключить в локальную сеть WAN портом

**Подключиться к роутеру через WAN**

* Подключаемся к роутеру по SSH (`ssh root@192.168.3.*`) и вводим команды для установки необходимого:
 - `opkg update`
 - `opkg install python3-light libustream-openssl ca-bundle ca-certificates`
 - `wget https://raw.githubusercontent.com/kitanin90/smart_wifi/master/tools/configure_router.py`

* Запускаем скрипт настройки роутера `python3 configure_router.py`

##### Отвечаем на вопрос:
 - Номер роутера по счету (порядковый)

##### В админ.панели Django " http://localhost/admin/ " добавляем новый роутер.
* Название
* IP-адрес под которым записан роутер "192.168.3.*" 
* Порт - 0
* Токен - Добавляем значение, вывел скрипт настройки в конце
* MAC-адрес - Можно посмотреть на обратной стороне роутера (либо в `ifconfig` ищите по ip-адресу )
* Корпус - где будет стоять данный роутер

![Alt text](img/img3.jpg?raw=true "Title")

##### Перезагрузить FreeRADIUS. Перейти в папку проекта и ввести в терминале `docker-compose restart freeradius`

### Добавление Корпусов и Факультетов
* Прежде всего добавьте корпуса в соответствующем разделе.
Заполните пункты: `Название` и `адрес`

* Аналогично добавьте факультеты

###  Создание клиентов:
#### Ручное добавление:
* Добавить новых клиентов можно в разделе `Клиенты`
* Заполнить соответствующие поля: ФИО, Username, Статус, Телефон, Факультет
* `Username` клиента состоит из его фамилии и инициалов (например, IvanovAA)

Чтобы задать пароль для клиента, перейдите и добавьте в `Параметры клиента`:
1. Заполните соответствующий `Username` клиента
2. В `Attribute` введите `Cleartext-Password`
3. `Op` будет содержать `:=`
4. В `Value` введите пароль для клиента

#### Автоматическое добавление:

Если у вас большая база клиентов, вы можете добавить их с помощью файла в формате `csv`. Для этого перейдите в браузере на `http://localhost/panel/upload_file`.
В данном случае, скрипт создаст и настроит параметры клиента вместо вас.

**Внимание!** 
Скрипт начинает считывать клиентов с 7 строки в вашей базе данных! Каждый параметр разделяется с помощью `;` в соответствующей колонки (Пример формата для заполнения БД: `;;ИвановАА;;;;Пароль;`)