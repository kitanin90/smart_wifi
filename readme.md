# smart_wifi
## I. Развертывание проекта на Ubuntu 

### 1. Установка python3 на Ubuntu
Выполнить команды в терминале:
* sudo apt update
* sudo apt install python3.7

### 2. Установить git на Ubuntu
Выполнить команды в терминале:
* sudo apt update
* sudo apt install git

### 3. Скачать проект с git
Выполнить команду в терминале:
* git clone https://github.com/kitanin90/smart_wifi.git

### 4. Установка Docker на Ubuntu 
* Выполните инструкцию на сайте https://www.digitalocean.com/community/tutorials/docker-ubuntu-18-04-1-ru

### Настройка проекта
После успешной загрузки необходимо провести ряд настроек:
* Скопировать `.env.example` в `.env` и отредактировать файл(Либо просто переименовать файл)
* Изменить настройки в `settings.py`
* Запустить `docker-compose up -d`
* Создать суперпользователя `docker-compose exec web python3 manage.py createsuperuser`
* Создать миграцию `docker-compose exec web python3 manage.py makemigrations`
* Выполнить миграцию `docker-compose exec web python3 manage.py migrate`

# Настройка роутеров на примере tp-link archer c7
1. Скачать прошивку Openwrt "http://downloads.openwrt.org/releases/18.06.4/targets/ar71xx/generic/openwrt-18.06.4-ar71xx-generic-archer-c7-v4-squashfs-factory.bin"
2. Подключиться к роутеру через сетевой кабель в любой LAN-порт.
3. В админ панели роутера в разделе "fireware upgrade" загрузить скачанный файл прошивки "OpenWrt"

![Alt text](img/img1.jpg?raw=true "Title")
##### Проводная сеть интернета у вас должна быть общедоступной.
4. Перейти по 192.168.1.1 (или 192.168.0.1) в админку openwrt. Поставить на роутер пароль.
5. В разделе "Interfeces" удалить интерфейс WAN6
6. Настроить интерфейс WAN:

* Ipv4 address - ip адрес роутера
* Ipv4 gateway - ip адрес сервера

![Alt text](img/img2.jpg?raw=true "Title")

**Внимание! Не забудьте в конце поставить галочку около "Ignore interface"**

* Настроить firewall для WAN input включить accept

![Alt text](img/firewall.png?raw=true "Title")


**Подключиться к роутеру через WAN**

8. Подключаемся к роутеру по ssh (ssh root@192.168.3.*)и вводим команды для установки необходимого:
 - opkg update
 - opkg install python3-light libustream-openssl ca-bundle ca-certificates
 - wget https://strbsu.tk/configure_router.py

При первом подключении через ssh, возможно выйдет оповещение. Достаточно просто скопировать и ввести строку начинающееся на "ssh-keygen -f ...". Можете заново повторить подключение


![Alt text](img/img3.jpg?raw=true "Title")

##### Отвечаем на два вопроса:
 - Номер роутера по счету(порядковый)
 - Ввести любое текстовое значение

##### Подключаемся повторно по ssh к роутеру (ssh root@192.168.3.*) и вводим команду:
* " cat /etc/config/chilli " находим строку secret и копируем значение

##### В админ.панели Django " http://localhost/admin/ " добавляем новый роутер.
* Название
* IP-адрес под которым записан роутер "192.168.3.*" 
* Порт - 0
* Токен - Добавляем значение, которое скопировали в терминале
* MAC-адрес - Можно посмотреть на обратной стороне роутера (либо в `ifconfig` ищите по ip-адресу )
* Корпус - где будет стоять данный роутер

![Alt text](img/img4.jpg?raw=true "Title")

##### Перезагрузить freeradfius. Перейти в папку проекта и ввести в терминале "docker-compose restart freeradius"

###    Добавление Корпусов и Факультетов
* Прежде всего добавьте корпуса в соответствующем разделе.
Заполните пункты: `Название` и `адрес`

* Аналогично добавьте факультеты

###  Создание клиентов:
#### Ручное добавление:
* Добавить новых клиентов можно в разделе `Клиенты`
* Заполнить соответствующие поля: ФИО, Username, Статус, Телефон, Факультет
* `Username` клиента состоит из его фамилии и инициалов (например, IvanovAA)

Чтобы задать пароль для клиента, перейдите и добавьте в `Параметры клиента`:
1. Заполните соответствующий `Username` клиента
2. В `Attribute` введите `Cleartext-Password`
3. `Op` будет содержать `:=`
4. В `Value` введите пароль для клиента

#### Автоматическое добавление:

Если у вас большая база клиентов, вы можете добавить их с помощью файла в формате `.csv`. Для этого перейдите в браузере на `http://localhost/panel/upload_file`.
В данном случае, скрипт создаст и настроит параметры клиента вместо вас.

**Внимание!** 
Скрипт начинает считывать клиентов с 7 строки в вашей базе данных! Каждый параметр разделяется с помощью `;` в соответствующей колонки(Пример формата для заполнения БД: `;;ИвановАА;;;;Пароль;`)


### Настройка точек доступа
Для системы нужно знать с какими роутерами ей нужно работать.
Подключитесь к роутеру через сетевой кабель по ssh и введите пароль от админ.панели роутера(например, ssh root@10.42.0.46). С помощью команды `ifconfig`
Для этого необходимо каждый роутер добавить в разделе `Роутеры`:
Некоторые данные можно узнать с помощью `ifconfig`, либо на обратной стороне роутера.
 * `Название`  - название роутрера
 * `ip`  - Ip-адрес узнайте в `ifconfig` 
 * `Порт`  - Обычно "0"
 * `Токен`  - Токен узнайте `ifconfig` (например, serkettoken)
 * `MAC`  - MAC узнайте в `ifconfig` (например, 1C-2S-3X-4Z-5T-6J)
 * `Корпус`  - Выберите корпус, в котором стоит роутер

**ВНИМАНИЕ!** После изменений в админ.панели Django, перезагрузите freeradius командой `docker-compose restart freeradius`

## I. Развертывание проекта на Windows

### 1. Установка python3 на Windows
* Для установки python3 следуйте инструкции на сайте https://python-scripts.com/install-python-windows

### 2. Установить git на Windows
* Для установки git следуйте инструкции на сайте https://hyperhost.ua/info/ustanovka-git-na-os-windows/

### 3. Скачать проект с git

* Открываете коммандную строку "Win+R" и пишите "cmd"
* Выбираете папку куда хотите скачать проект ("cd .." - вернуться на раздел раньше, "cd name" - открыть папку под именем name, "mkdir name" - создать папку под именем name )
* Скачиваете проект git clone https://github.com/kitanin90/smart_wifi.git

### 4. Установка Docker на Windows 
* Перейти на сайт https://www.docker.com/products/docker-desktop и выбрать "Download Desktop for Mac and Windows"
* Потребуется регистрация на сайте
* Запустить установочный файл и следовать инструкции (Для примера можете посмотреть англоязычный ролик https://www.youtube.com/watch?v=2Rc7glcM3D80)

### Процесс настройки проекта аналогичен с ОС Ubuntu